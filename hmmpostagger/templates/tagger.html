{% extends 'layout.html' %}
{% block title %}实战{% endblock %}
{% block header %}
    <li><a href='/'>主页</a></li>
    <li><a href='/tagger' class="active">实战</a></li>
{% endblock %}
{% block main %}
    <div id="container" class="'container">
        <div id="row">
            <h3 id="loadtitle">输入中文句子, 点击按钮进行词性标注</h3>
            <textarea id="userinput"></textarea>
            <button id="analysis" onclick="tagger()">分析</button>
        </div>
        <div id="result" style="display: none;">
            <h3 id="title">词性标注结果</h3>
            <div id="board"></div>
        </div>
    </div>
    <script>
        function tagger(){
            document.getElementById('board').innerHTML = "";  // 清空结果
            var content = document.getElementById("userinput").value;
            if (content == ""){
                alert("请输入句子!") // 对空值进行处理
            }else{
                document.getElementById("loadtitle").innerHTML = "正在进行分析,请耐心进行等待"  // 更新标题元素
                document.getElementById('result').style.display="none";  // 结果不可见
                document.getElementById('analysis').disabled=true;  // 禁用按钮
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        myfunction(this.responseText);
                        document.getElementById("loadtitle").innerHTML = "输入中文句子, 点击按钮进行词性标注"; // 恢复标题
                        document.getElementById("userinput").value = "";  // 清空输入框
                        document.getElementById('analysis').disabled=false; // 启用按钮
                    }
                };
                xhttp.open("POST", "/predict", true);  // 使用异步传输
                xhttp.setRequestHeader('Content-type','application/x-www-form-urlencoded')
                xhttp.send('content='+content);
            }    
        }
        function myfunction(text){
            document.getElementById('result').style.display="block";  // 结果可见
            var parent = document.getElementById('board');
            seq_lst = text.split("&");  // 切分不同句子
            for(var i = 0; i < seq_lst.length-1;i++){
                seq = seq_lst[i].split(' ')  // 切分句子中的语块
                inner_html = '<p>'
                for(var j=0; j<seq.length;j++){
                    token = seq[j].split('/')   // 切分原词和标注
                    inner_html += token[0]+'/'+'<span>'+token[1]+'</span>'
                    inner_html += "&nbsp;&nbsp;"
                }
                inner_html += '</p>'
                parent.innerHTML +=inner_html  // 向board中添加元素
            }
        }
    </script>
{% endblock %}